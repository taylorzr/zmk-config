units:
  pinky_rotation: 10 # degrees rotation relative to zone rotation
  pinky_spread: 1.0u
  
  ring_rotation: 5
  ring_spread: 1.04u

  middle_rotation: 3
  middle_spread: 1.02u

  index_rotation: 0
  index_spread: 1.015u 

  inner_rotation: 0
  inner_spread: 1.0u

  choc_plate_thickness: 1.2
  mx_plate_thickness: 1.5

points:
  mirror:
    ref: thumb_right_home
    distance: 50
  rotate: 0
  key: # each key across all zones will have these properties
    bind: 5
    width: 1u
    height: 1u
    tags:
      1u: true
    footprints: # These footprints will be added for each of the points
      choc_hotswap:
        type: MX
        nets:
          to: "{{key_net}}"
          from: GND
        params:
          reverse: false
          hotswap: true
          # Don't show a model for this since 'choc' already loads the model
          model: false
          keycaps: false
      choc:
        type: MX
        anchor:
          rotate: 180
        nets:
          to: "{{key_net}}"
          from: GND
        params:
          keycaps: true
          reverse: false
  zones:
    matrix:
      key:
        tags:
          not_thumb: true
      rotate: -15
      rows:
        bottom.padding: 1u
        home.padding: 1u
        top.padding: 1u
      columns:
        outer:
          key:
            splay: pinky_rotation
            #tags: outer
          rows:
            bottom.skip: true
            home.key_net: P106
            home.key.tags: outer
            top.skip: true
        pinky:
          key:
            splay: pinky_rotation - pinky_rotation
            stagger: 0
            spread: pinky_spread
          rows:
            bottom.key_net: P104
            home.key_net: P102
            top.skip: true
        ring:
          key:
            splay: ring_rotation - pinky_rotation
            stagger: 5
            spread: ring_spread
          rows:
            bottom.key_net: P101
            home.key_net: P103
            top.key_net: P100
        middle:
          key:
            splay: middle_rotation - ring_rotation
            stagger: 5
            spread: middle_spread
          rows:
            bottom.key_net: P022
            home.key_net: P029
            top.key_net: P030
        index:
          key:
            splay: index_rotation - middle_rotation
            stagger: -5
            spread: index_spread
          rows:
            bottom.key_net: P031
            home.key_net: P004
            top.key_net: P005
        inner:
          key:
            splay: inner_rotation - index_rotation
            stagger: -5
            spread: inner_spread
          rows:
            bottom.key_net: P007
            home.key_net: P109
            top.key_net: P012
    thumb:
      key:
        tags:
          thumb: true
      anchor:
        ref: matrix_index_bottom
        shift: [ 0.75u, -1.75u]
      columns:
        left:
          key:
            splay: -10
            stagger: -5
            origin: [ -0.5u, -.75u ]
            key_net: P009
            rotate: 90
            width: 1.5u
        right:
          key:
            spread: 1.05u
            stagger: 0.15u # Move up by 0.25cy so a 1.5cy keycap lines up with the bottom
            splay: -15 # -25 degrees cumulative
            origin: [-1.1u, -0.75u] # Pivot at the lower left corner of a 1.5u choc key
            height: 1u
            width: 1.5u
            rotate: 90
            tags:
              15u: true
              1u: false
            key_net: P010
      rows:
        home:
          padding: 0

outlines:
  _switch_holes:
    - what: rectangle
      where: true
      asym: left
      size: 14

  _keycaps:
    - what: rectangle
      where: not_thumb
      asym: both
      size: 18
    - what: rectangle
      where: thumb
      size: [27,18]

  perimeter:
    - what: rectangle
      where: not_thumb
      asym: both
      size: 1.5u
      corner: 4.01
    - what: rectangle
      where: thumb
      asym: both
      size: [2u, 1.5u]
      corner: 4.01

  microcontroller_rect:
    - what: rectangle
      adjust: 
        ref: matrix_pinky_home
        shift: [0u, 1.1u]
      size: [25,1.25u]
      corner: 3

  _xiao:
    - what: rectangle
      adjust: 
        ref: matrix_pinky_home
        shift: [0u, 1.25u]
      size: [17.5,20]
      corner: 3
    
  _left_perimeter_joiner:
    - what: polygon
      operation: stack
      points:
        - ref: matrix_inner_bottom
          shift: [0.5u, -0u]
        - ref: thumb_right_home
          shift: [-0.25u, -0.75u]
        - ref: thumb_left_home
          shift: [-0.4u, 0u]
        - ref: matrix_index_bottom
          shift: [-0u, -0.25u]

  _right_perimeter_joiner:
    - what: polygon
      operation: stack
      points:
        - ref: mirror_matrix_index_bottom
          shift: [-0u, -0.25u]
        - ref: mirror_thumb_left_home
          shift: [-0.4u, 0u]
        - ref: mirror_thumb_right_home
          shift: [-0.25u, -0.75u]
        - ref: mirror_matrix_inner_bottom
          shift: [0.5u, -0u]

  perimeter_demo:
    - perimeter
    - microcontroller_rect
    - _left_perimeter_joiner
    - _right_perimeter_joiner
    - -_keycaps
    - -_xiao  

  perimeter_switch_plate:
    - perimeter
    - microcontroller_rect
    - _left_perimeter_joiner
    - _right_perimeter_joiner
    - -_switch_holes
    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: matrix_pinky_bottom
        shift: [-0.525u, -0.5u]
    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: matrix_outer_home
        shift: [-0.525u, 0.5u]
    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: matrix_middle_top
        shift: [-0.525u, 0.525u]
    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: matrix_ring_bottom
        shift: [0.525u, -0.525u]
    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: matrix_ring_bottom
        shift: [0.525u, -0.525u]
    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: matrix_inner_top
        shift: [0.525u, 0.5u]
    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: matrix_inner_bottom
        shift: [0.525u, -0.5u]
    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: thumb_right_home
        shift: [0.725u, -0.5u]
    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: thumb_right_home
        shift: [-0.725u, -0.5u]
    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: thumb_left_home
        shift: [-0.725u, 0.5u]

    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: mirror_matrix_inner_top
        shift: [0.525u, 0.5u]
    - what: circle
      operation: subtract
      radius: 2
      adjust:
        ref: mirror_matrix_inner_bottom
        shift: [0.525u, -0.5u]

  polygon_left:
    - what: polygon
      operation: stack
      points:
        - ref: matrix_outer_home
          shift: [-0.5u,0.5u]
        - ref: matrix_ring_top
          shift: [-0.5u,0.5u]
        - ref: matrix_middle_top
          shift: [-0.5u,0.5u]
        - ref: matrix_middle_top
          shift: [0.5u,0.5u]
        - ref: matrix_index_top
          shift: [0.5u,0.5u]
        - ref: matrix_inner_top
          shift: [0.5u,0.5u]
        - ref: thumb_right_home
          shift: [0.5u, -0.5u]
        - ref: thumb_right_home
          shift: [-0.5u,-0.5u]
        - ref: thumb_left_home
          shift: [-0.5u,0.5u]
        - ref: matrix_pinky_bottom
          shift: [-0.5u, -0.5u]
        - ref: matrix_outer_home
          shift: [-0.5u,-0.5u]  
  
  _polygon_right:
    - what: polygon
      operation: stack
      points:
        - ref: mirror_matrix_inner_top
          shift: [0.5u,0.5u]
        - ref: mirror_matrix_index_top
          shift: [0.5u,0.5u]
        - ref: mirror_matrix_middle_top
          shift: [0.5u,0.5u]
        - ref: mirror_matrix_middle_top
          shift: [-0.5u,0.5u]
        - ref: mirror_matrix_ring_top
          shift: [-0.5u,0.5u]
        - ref: mirror_matrix_outer_home
          shift: [-0.5u,0.5u]
        - ref: mirror_matrix_outer_home
          shift: [-0.5u,-0.5u]  
        - ref: mirror_matrix_pinky_bottom
          shift: [-0.5u, -0.5u]
        - ref: mirror_thumb_left_home
          shift: [-0.5u,0.5u]
        - ref: mirror_thumb_right_home
          shift: [-0.5u,-0.5u]
        - ref: mirror_thumb_right_home
          shift: [0.5u, -0.5u]

  _poly_center:
    - what: polygon
      operation: stack
      points:
        - ref: matrix_inner_top
          shift: [9,0.5u]
        - ref: mirror_matrix_inner_top
          shift: [9,0.5u]
        - ref: mirror_thumb_right_home
          shift: [9,-0.5u]
        - ref: thumb_right_home
          shift: [9,-0.5u]

  monoblock:
    [polygon_left, _polygon_right, _poly_center]
  
  split_switch_plate:
    [polygon_left, -_switch_holes]
  
  monoblock_switch_plate:
    [monoblock, -_switch_holes]
cases:
  perimeter:
    - what: outline
      name: perimeter_switch_plate
      extrude: mx_plate_thickness
  monoblock_switch_plate:
    - what: outline
      name: monoblock_switch_plate
      extrude: mx_plate_thickness
  monoblock_bottom:
    - what: outline
      name: monoblock
      extrude: mx_plate_thickness
  split_switch_plate:
    - what: outline
      name: split_switch_plate
      extrude: mx_plate_thickness
  split_bottom:
    - what: outline
      name: polygon_left
      extrude: mx_plate_thickness
  perimeter_switch_plate:
    - what: outline
      name: perimeter_switch_plate
      extrude: mx_plate_thickness
