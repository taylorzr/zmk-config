units:
  # Parameters
  row_spacing: 1u

  pinky_rotation: 10 # degrees rotation relative to zone rotation
  pinky_stagger: 0 # mm, relative to previous column
  pinky_spread: 1.05u
  
  ring_rotation: 5
  ring_stagger: 0.25u
  ring_spread: 1.08u

  middle_rotation: 3
  middle_stagger: 0.25u
  middle_spread: 1.1u

  index_rotation: -1
  index_stagger: -5
  index_spread: 1.05u

  inner_rotation: -2
  inner_stagger: -5
  inner_spread: 1.04u

  # Constants
  choc_cap_x: 19.05
  choc_cap_y: 19.05 

  choc_plate_thickness: 1.2
  mx_plate_thickness: 1.5

points:
  mirror:
    ref: thumb_right_home
    distance: 75
  rotate: 0
  key: # each key across all zones will have these properties
    bind: 5
    width: 1u
    height: 1u
    tags:
      1u: true
    footprints: # These footprints will be added for each of the points
      choc_hotswap:
        type: MX
        nets:
          to: "{{key_net}}"
          from: GND
        params:
          reverse: false
          hotswap: true
          # Don't show a model for this since 'choc' already loads the model
          model: false
          keycaps: false
      choc:
        type: MX
        anchor:
          rotate: 180
        nets:
          to: "{{key_net}}"
          from: GND
        params:
          keycaps: true
          reverse: false
  zones:
    matrix:
      rotate: -15
      rows:
        bottom.padding: row_spacing
        home.padding: row_spacing
        top.padding: row_spacing
      columns:
        outer:
          key:
            splay: pinky_rotation
          rows:
            bottom.skip: true
            home.key_net: P106
            top.skip: true
        pinky:
          key:
            splay: pinky_rotation - pinky_rotation
            stagger: pinky_stagger
            spread: pinky_spread
          rows:
            bottom.key_net: P104
            home.key_net: P102
            top.skip: true
        ring:
          key:
            splay: ring_rotation - pinky_rotation
            stagger: ring_stagger
            spread: ring_spread
          rows:
            bottom.key_net: P101
            home.key_net: P103
            top.key_net: P100
        middle:
          key:
            splay: middle_rotation - ring_rotation
            stagger: middle_stagger
            spread: middle_spread
          rows:
            bottom.key_net: P022
            home.key_net: P029
            top.key_net: P030
        index:
          key:
            splay: index_rotation - middle_rotation
            stagger: index_stagger
            spread: index_spread
          rows:
            bottom.key_net: P031
            home.key_net: P004
            top.key_net: P005
        inner:
          key:
            splay: inner_rotation - index_rotation
            stagger: inner_stagger
            spread: inner_spread
          rows:
            bottom.key_net: P007
            home.key_net: P109
            top.key_net: P012
    thumb:
      anchor:
        ref: matrix_index_bottom
        shift: [ 0.75u, -1.75u]
      columns:
        left:
          key:
            splay: -10
            stagger: -5
            origin: [ -0.5u, -.75u ]
            key_net: P009
            rotate: 90
            width: 1.5u
        right:
          key:
            spread: 1.05u
            stagger: 0.15u # Move up by 0.25cy so a 1.5cy keycap lines up with the bottom
            splay: -15 # -25 degrees cumulative
            origin: [-1u, -0.75u] # Pivot at the lower left corner of a 1.5u choc key
            height: 1u
            width: 1.5u
            rotate: 90
            tags:
              15u: true
              1u: false
            key_net: P010
      rows:
        home:
          padding: 0

outlines:
  switch_holes:
    - what: rectangle
      where: true
      asym: both
      size: 14
  polygon_left:
    - what: polygon
      operation: stack
      points:
        - ref: matrix_outer_home
          shift: [-0.5u,0.5u]
        - ref: matrix_ring_top
          shift: [-0.5u,0.5u]
        - ref: matrix_middle_top
          shift: [-0.5u,0.5u]
        - ref: matrix_middle_top
          shift: [0.5u,0.5u]
        - ref: matrix_index_top
          shift: [0.5u,0.5u]
        - ref: matrix_inner_top
          shift: [0.5u,0.5u]
        - ref: thumb_right_home
          shift: [0.5u, -0.5u]
        - ref: thumb_right_home
          shift: [-0.5u,-0.5u]
        - ref: thumb_left_home
          shift: [-0.5u,0.5u]
        - ref: matrix_pinky_bottom
          shift: [-0.5u, -0.5u]
        - ref: matrix_outer_home
          shift: [-0.5u,-0.5u]  
  polygon_right:
    - what: polygon
      operation: stack
      points:
        - ref: mirror_matrix_inner_top
          shift: [0.5u,0.5u]
        - ref: mirror_matrix_index_top
          shift: [0.5u,0.5u]
        - ref: mirror_matrix_middle_top
          shift: [0.5u,0.5u]
        - ref: mirror_matrix_middle_top
          shift: [-0.5u,0.5u]
        - ref: mirror_matrix_ring_top
          shift: [-0.5u,0.5u]
        - ref: mirror_matrix_outer_home
          shift: [-0.5u,0.5u]
        - ref: mirror_matrix_outer_home
          shift: [-0.5u,-0.5u]  
        - ref: mirror_matrix_pinky_bottom
          shift: [-0.5u, -0.5u]
        - ref: mirror_thumb_left_home
          shift: [-0.5u,0.5u]
        - ref: mirror_thumb_right_home
          shift: [-0.5u,-0.5u]
        - ref: mirror_thumb_right_home
          shift: [0.5u, -0.5u]

  _poly_center:
    - what: polygon
      operation: stack
      points:
        - ref: matrix_inner_top
          shift: [9,0.5u]
        - ref: mirror_matrix_inner_top
          shift: [9,0.5u]
        - ref: mirror_thumb_right_home
          shift: [9,-0.5u]
        - ref: thumb_right_home
          shift: [9,-0.5u]
  monoblock:
    [polygon_left, polygon_right, _poly_center]
  split_switch_plate:
    [polygon_left, -switch_holes]
  monoblock_switch_plate:
    [monoblock, -switch_holes]
cases:
  monoblock_switch_plate:
    - what: outline
      name: monoblock_switch_plate
      extrude: mx_plate_thickness
  monoblock_bottom:
    - what: outline
      name: monoblock
      extrude: mx_plate_thickness
  split_switch_plate:
    - what: outline
      name: split_switch_plate
      extrude: mx_plate_thickness
  split_bottom:
    - what: outline
      name: polygon_left
      extrude: mx_plate_thickness

